<script src="http://code.jquery.com/jquery-1.9.0.min.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/raphael/2.1.0/raphael-min.js"></script>
<script src="http://cdn.oesmith.co.uk/morris-0.5.1.min.js"></script>
<link rel="import" href="bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/morris.js/0.5.1/morris.css">

<dom-module id="morris-donut-chart">
    <template>
        <style include="">
            :host {
                text-align: center;
                position: relative;
            }
            .big{
                overflow: auto;
            }

        </style>

        <iron-ajax
                id="morrisChartData"
                url="{{data}}"
                handle-as="json"
                on-request="startRequest"
                on-response="parseResponse"
                ></iron-ajax>

        <div class="big">
            Morris component
            <div id="donut-example"></div>
        </div>

    </template>
</dom-module>

<script>
    Polymer({
        is: 'morris-donut-chart',
        properties: {
            elements: String,
            pressed: {
                type: Boolean,
                value: false,
                notify: true,
                reflectToAttribute: true
            },
            data:String
        },
        listeners: {
            'tap': 'toggle'
        },
        toggle: function() {
            this.pressed = !this.pressed;
        },
//        attached: function() {
//            console.debug(this['is'], "ready!;" );
//
//            // make AJAX REQUEST
//
//            Morris.Donut({
//                element: 'donut-example',
//                resize: true,
//                data: this.data,
//                formatter: function (x) { return x + "%"}
//            }).on('click', function(i, row){
//                console.log(i, row);
//            });
//
//        },

        renderChart: function () {
            Morris.Donut({
                element: 'donut-example',
                resize: true,
                data: this.data,
                formatter: function (x) { return x + "%"}
            }).on('click', function(i, row){
                console.log(i, row);
            });
        },

        ready: function(){

            console.info("Chart json data is :" + this.data);

            this.$.morrisChartData.generateRequest();
        },
        startRequest:function () {

            console.info("Start request to chart data");

        },
        parseResponse:function (event) {
            console.info("read data:" + JSON.stringify(event.detail.response));

            if(!!event.detail.response.chartData){

                this.data = event.detail.response.chartData;
                this.renderChart();
            }

        }

    });

</script>
